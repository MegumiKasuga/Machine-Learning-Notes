方差分析要解决的问题：<mark style="background: #ADCCFFA6;">检验多个总体均值是否有显著性差异</mark>。

#### 基本概念
因素：影响实验结果的条件，用大写字母A, B, C, ...等表示。
- **单因素实验：研究中只考察一个因素。**
- **双因素(多因素实验)：同时研究两个或两个以上的因素。**
因素水平/水平：因素所处的某种特定状态或数量等级，用代表该因素的字母加下标表示，如$A_{1}, A_{2}, \dots, B_{1}, B_{2}, \dots$。
处理：事先设计好的实施在实验单位上的具体项目
- **在单因素实验中，实施在实验单位上的具体项目就是试验因素的某一水平。**
- **在多因素实验中，试验因素的一个水平组合就是一个处理。**
两类误差：
- **随机误差：在因素的同一水平(或同一总体)下，样本的各观察值之间的差异，由抽样的随机性造成。**
- **系统误差：在因素的不同水平(不同总体)下，各观察值之间的差异，由系统性因素造成。**
两类方差：
- **组内方差：因素的同一水平(或同一总体)下样本数据的方差，组内方差只包含随机误差。**
- **组间方差：因素的不同水平(不同总体)下各样本之间的方差，组间方差既包括随机误差，也包括系统误差。**

#### 基本原理
- <mark style="background: #FF5582A6;">将K个处理的观测值作为一个整体看待，把观测值总离差平方和及自由度分解为相应于不同变异来源(组内方差和组间方差)的平方和及自由度。</mark>
- <mark style="background: #FF5582A6;">通过计算组间方差和组内方差的适当比值，检验各样本所属总体平均数是否相等。</mark>

#### 基本假定
1) 观察值之间相互独立
2) 每个总体都应服从正态分布(分布的正态性)
3) 各组观察数据，是从具有相同方差的总体中抽取的。

### 单因素方差分析
#### 多个总体均值是否相同的检验
##### SST, SSE和SSA
<mark style="background: #FF5582A6;">m表示因素的水平数(即有几个因素)，n表示每个因素水平的样本数。</mark>
**SST：总离差平方和，表示变量$x_{ij}$相对于中心$\bar{x}$的变动**
**SSE：残差平方和，表示变量$x_{ij}$相对于估计值$\bar{X}_{i}$的变动**
**SSA(SSR)：回归平方和，表示估计值$\bar{X}_{i}$相对于中心$\bar{x}$的变动**
$$SST=\sum_{i=1}^m\sum_{j=1}^n(x_{ij}-\bar{x})^2$$$$SSE=\sum_{i=1}^m\sum_{j=1}^n(X_{ij}-\bar{X_{i}})^2$$$$SSA=\sum_{i=1}^m n(\bar{X}_{i}-\bar{X})^2$$$$SST=SSE+SSA$$
**定理**：**在单因素方差分析中，SST, SSA与SSE相互独立。且$$\frac{SST}{\sigma^2}\sim X^2(mn-1)$$$$\frac{SSE}{\sigma^2}\sim X^2(mn-m)$$$$\frac{SSA}{\sigma^2}\sim X^2(m-1)$$从而$$F=\frac{\frac{SSA}{(m-1)}}{\frac{SSE}{(mn-m)}}\sim F(m-1, mn-m)$$**
##### 自由度
SST的自由度：$f_{T}$，计算方法：总样本数-1(即$mn-1$)
SSA的自由度：$f_{A}$，计算方法：总水平数-1(即$m-1$)
SSE的自由度：$f_{E}$，计算方法：$f_{E}=f_{T}-f_{A}$(即$mn-m$)

##### 均方和
SSA的均方和：$MS_{A}=\frac{SSA}{f_{A}}$
SSE的均方和：$MS_{E}=\frac{SSE}{f_{E}}$

##### F值
$$F=\frac{MS_{A}}{MS_{E}}$$
##### 分析过程
1. 建立假设：$H_{0}: \mu_{1}=\mu_{2}=\dots=\mu_{m}$
2. 算出SSA, SSE和SST
3. 算出自由度$f_{A}, f_{E}$
4. 算出均方和$MS_{A}$和$MS_{E}$
5. 计算出F值
6. 检验
	- 若$F\leq F_{0.05}(f_{A}, f_{E})$，则无显著影响，记为/
	- 若$F_{0.05}(f_{A},f_{E})<F<F_{0.01}(f_{A},f_{E})$，则影响较显著，记为*
	- 若$F>F_{0.01}(f_{A},f_{E})$，则影响特别显著，记为**

#### 多个总体均值的多重比较检验
方差分析可以对多个均值是否相等进行检验，但是，当拒绝$H_{0}$，表示均值不完全像扽，但是具体哪几个均值显著不同？就需要<mark style="background: #FF5582A6;">多重比较检验</mark>。
多重比较：在因变量的三个或三个以上水平下均值之间进行两两比较检验，检验均值间差异。
LSD方法：由Fisher提出的最小显著差异方法，是对检验两个总体是否相等的t检验方法加以修正。

##### LSD的操作步骤
1) 提出假设
	$H_{0}:\mu_{i}=\mu_{j}$(第i个总体的均值等于第j个总体的均值)
	$H_{1}:\mu_{i}=\mu_{j}$(第i个总体的均值不等于第j个总体的均值)
2) 检验的统计量为
$$t=\frac{\bar{x}_{i}-\bar{x}_{j}}{\sqrt{ MS_{E}\left( \frac{1}{n_{i}} + \frac{1}{n_{j}} \right) }}$$也就是
$$t=\frac{\frac{\bar{x}_{i}-\bar{x}_{j}}{\sqrt{ \left( \frac{\sigma^2}{n_{i}}+\frac{\sigma^2}{n_{j}} \right) }}}{\sqrt{ \frac{\sum_{i=1}^k\sum_{j=1}^n(x_{ij}-\bar{x}_{i})^2}{\sigma^2f_{E}} }}$$
3) 若$|t|\geq t_{\frac{2}{\alpha}}$，拒绝$H_{0}$；若$|t|<t_{\frac{2}{\alpha}}$，不能拒绝$H_{0}$

##### 基于统计量 $\bar{x}_{i}-\bar{x}_{j}$的LSD方法的操作步骤
1) 计算LSD($\bar{x}_{i}-\bar{x}_{j}$的临界值)$$LSD=t_{\frac{\alpha}{2}}\sqrt{ MS_{E}\left( \frac{1}{n_{i}}+\frac{1}{n_{j}} \right) }$$
2) 检验
	若$|\bar{x}_{i}-\bar{x}_{j}|\geq LSD$，拒绝$H_{0}$，若$|\bar{x}_{i}-\bar{x}_{j}|<LSD$，接受$H_{0}$

### 双因素方差分析
#### 无交互作用双因素方差分析
双因素：指问题中由两个(反映条件或前提的)变量
- $A_{r}$是变量$A$的一个取值($A$的一个水平)
- $B_{n}$是变量$B$的一个取值($B$的一个水平)
假设$A$与$B$无交互作用。设在双因素各种水平的组合下进行试验(试验1次)。

##### 分解总离差平方和
根据单因素分析，仿照之进行分解可知：$$SST=SSA+SSB+SSE~~~~~~(无交互作用)$$
SSA: 因素A的回归平方和
SSB: 因素B的回归平方和
SSAB: AB交互因素的回归平方和
SSE: 残差平方和
$$SSA=\sum n(\bar{x}_{i}-\bar{x})^2$$$$SSB=\sum r(\bar{x}_{j}-\bar{x})^2$$$$SSE=\sum \sum(x_{ij}-\bar{x}_{i}-\bar{x}_{j}+\bar{x})^2$$
##### 自由度
SST: $nr-1$
SSA: $r-1$
SSB: $n-1$
SSE: $nr-r+n+1=(n-1)(r-1)$

##### 均方化
对因素A而言：$MS_{A}=\frac{SSA}{r-1}$
对因素B而言：$MS_{B}=\frac{SSB}{n-1}$
对随机误差而言：$MS_{E}=\frac{SSE}{nr-r-n-1}$

##### 求F值
$$F_{A}=\frac{MS_{A}}{MS_{E}}\sim F[r-1,(r-1)(n-1)]$$
$$F_{B}=\frac{MS_{B}}{MS_{E}}\sim F[n-1,(r-1)(n-1)]$$
##### 不考虑相互作用的双因素方差分析步骤
1) 提出原假设和备择假设$$\left\{\begin{align}
H_{01}: A没有显著影响 \\
H_{11}: A有显著影响~~~~
\end{align}\right.$$$$\left\{\begin{align}
H_{02}: B没有显著影响 \\
H_{12}: B有显著影响~~~~
\end{align}\right.$$
2) 计算方差分析表
#### 有交互作用双因素方差分析
##### 分解总离差平方和
$$SST=SSA+SSB+SSAB+SSE~~~~~~(有交互作用)$$
$$SST=\sum \sum \sum(x_{ijl}-\bar{x})^2$$
$$SSA=nm\sum(\bar{x}_{i}-\bar{x})^2$$
$$SSB=rm\sum(\bar{x}_{j}-\bar{x})^2$$
$$SSAB=m\sum \sum(\bar{x}_{ij.}-\bar{x}_{i..}-\bar{x}_{.j.}+\bar{x})^2$$
$$SSE=\sum \sum \sum(x_{ijl}-\bar{x}_{ij.})^2$$
##### 各个平方和的自由度
SST: $rnm-1$
SSA: $r-1$
SSB: $n-1$
SSAB: $(r-1)(n-1)$
SSE: $rn(m-1)$

##### 均方差
$$MS_{A}=\frac{SSA}{r-1}$$
$$MS_{B}=\frac{SSB}{n-1}$$
$$MS_{AB}=\frac{SSAB}{(r-1)(n-1)}$$
$$MS_{E}=\frac{SSE}{rn(m-1)}$$
##### 求F值
$$F_{A}=\frac{MS_{A}}{MS_{E}}\sim F(r-1, rnm-rn)$$
$$F_{B}=\frac{MS_{B}}{MS_{E}}\sim F(n-1,rnm-rn)$$
检验交互影响是否显著的统计量度是
$$F_{AB}=\frac{MS_{AB}}{MS_{E}}\sim F[(r-1)(n-1),rnm-rn]$$
##### 考虑相互作用的双因素方差分析步骤
1) 提出原假设，备择假设$$\left\{\begin{align}
H_{01}: A没有显著影响 \\
H_{11}: A有显著影响~~~~
\end{align}\right.$$$$\left\{\begin{align}
H_{02}: B没有显著影响 \\
H_{12}: B有显著影响~~~~
\end{align}\right.$$$$\left\{\begin{align}
H_{0}: A和B的交互效应不显著 \\
H_{1}: A和B的交互效用显著~~~~
\end{align}\right.$$
2) 计算并分解离差平方和：$SST=SSA+SSB+SSAB+SSE$
3) 计算出各平方和的自由度
4) 均方化
5) 计算出F统计量